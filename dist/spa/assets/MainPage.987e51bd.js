import{r,E as i,O as m,K as n,J as o,G as s,R as f,H as ne,Q as p,N as c,P as I,au as ue,L as A,av as re,q as ie,D as L,F as E,T as de}from"./index.7d30eca8.js";import{l as P,m as Q}from"./QDialog.b0ec289d.js";import{Q as ce,a as B,b as me}from"./QTable.21f90b65.js";import{Q as F,a as M}from"./QTd.e5502f91.js";import{Q as G,C as pe}from"./ClosePopup.848036a8.js";import{c as q,b as ve,Q as Z}from"./QCard.54856d72.js";import{Q as fe,a as v}from"./QForm.879987df.js";import{Q as j}from"./QCardActions.37c438c7.js";import{d as z}from"./docente.900f8bd9.js";const ge={class:"q-pa-md"},be={class:"row justify-between"},_e=n("div",{class:"col-9"},[n("div",{class:"col q-table__title",inline:""},[n("b",null,"Administrar Docentes")])],-1),he={class:"col-3",align:"right"},we=n("div",{class:"col q-table__title"},[n("b",null,"Lista de Docentes")],-1),ye={key:0,style:{display:"inline"}},Oe={style:{display:"inline"}},Ce=n("div",{class:"q-pa-md"},null,-1),Ne={class:"text-h6"},Ve={class:"row"},Ae={class:"row"},Qe={class:"row"},ke={class:"col-6"},Ke={class:"col-6"},De={class:"row"},Ee={class:"col-2"},xe={class:"col-10 q-pt-xs"},Be={__name:"MainPage",setup(Ue){const R=ve(),k=r(null),g=r(null),b=r(null),_=r(null),h=r(null),w=r(null),y=r(null),H=r(null),O=r(null);r([]);const K=r(null),J=["DOCENTE","DIRECTOR"],D=r(!1),x=r(null),U=r(null),W=[{name:"nombre",align:"center",label:"Nombre",field:"nombre",style:"max-width: 200px; white-space: break-spaces;"},{name:"cedula",align:"center",label:"C\xE9dula",field:"cedula"},{name:"correo",align:"center",label:"Email",field:"correo"},{name:"dedicacion",align:"center",label:"Dedicaci\xF3n",field:"dedicacion",style:"max-width: 200px; white-space: break-spaces;"},{name:"rol",align:"center",label:"Rol",field:"rol"},{name:"estado",align:"center",label:"Estado Cuenta",field:"estado"}],S=r([]),C=r(!1),d=ne(),N=async()=>{await z.obtenerDocentes(a=>{if(a.status==401)return u("NO OK",a.message),d.push({path:"/login"});if(a.status==403)return u("NO OK",a.message),d.push({path:"/"});if(a.status!=200)return u("NO OK",a.message);let l=[];U.value=a.data;for(let e=0;e<U.value.length;e++){const t=U.value[e],V=`${t.primerNombre} ${t.segundoNombre} ${t.primerApellido} ${t.segundoApellido}`;l.push({id:t._id,nombre:V,primerNombre:t.primerNombre,segundoNombre:t.segundoNombre,primerApellido:t.primerApellido,segundoApellido:t.segundoApellido,estado:t.usuario.estado,isActual:!!t.isActual,rol:t.usuario.rol.nombre.toUpperCase(),cedula:t.cedula,correo:t.correo,dedicacion:t.dedicacion})}S.value=l})},X=async a=>{await z.crearDocente(a,l=>{if(l.status==401)return u("NO OK",l.message),d.push({path:"/login"});if(l.status==403)return u("NO OK",l.message),d.push({path:"/"});if(l.status!=200)return u("NO OK",l.message);u("OK",l.data.message),T(),N()})},Y=async(a,l)=>{await z.editarDocente(a,l,e=>{if(e.status==401)return u("NO OK",e.message),d.push({path:"/login"});if(e.status==403)return u("NO OK",e.message),d.push({path:"/"});if(e.status!=200)return u("NO OK",e.message);u("OK",e.data.message),T(),N()})},ee=async()=>{await $(),k.value="Crear Nuevo Docente",C.value=!0},le=async a=>{await $(),K.value=a.id,k.value="Editar Informaci\xF3n del Docente",g.value=a.primerNombre,b.value=a.segundoNombre,_.value=a.primerApellido,h.value=a.segundoApellido,w.value=a.correo.split("@")[0],y.value=a.cedula,O.value=a.dedicacion,C.value=!0},T=()=>{C.value=!1,$()},ae=async a=>{D.value=!0,x.value=a},oe=async()=>{await L.cambiarEstado(x.value.cedula,a=>{if(a.status==401)return u("NO OK",a.message),d.push({path:"/login"});if(a.status==403)return u("NO OK",a.message),d.push({path:"/"});if(a.status!=200)return u("NO OK",a.message);u("OK","El estado de la cuenta del docente ha sido cambiado"),D.value=!1,N()})},te=async()=>{const a={primerNombre:g.value,segundoNombre:b.value,primerApellido:_.value,segundoApellido:h.value,cedula:y.value,correo:w.value+"@unl.edu.ec",dedicacion:O.value};return K.value==null?X(a):Y(K.value,a)},$=()=>{k.value=null,g.value=null,b.value=null,_.value=null,h.value=null,w.value=null,y.value=null,H.value=null,O.value=null,K.value=null},se=async a=>{await L.cambiarRol(a.id,a.rol.toLowerCase(),l=>{if(l.status==401)return u("NO OK",l.message),d.push({path:"/login"});if(l.status==403)return u("NO OK",l.message),d.push({path:"/"});if(l.status!=200)return u("NO OK",l.message);u("OK","El rol del docente ha sido cambiado"),N()})},u=(a,l)=>{a=="OK"?R.notify({color:"green-5",textColor:"white",icon:"mdi-check-bold",message:l}):R.notify({color:"red-5",textColor:"white",icon:"warning",message:l})};return N(),(a,l)=>(i(),m(f,null,[n("div",ge,[o(q,{class:"my-card"},{default:s(()=>[o(Q,{class:"card-title-gestionar"},{default:s(()=>[n("div",be,[_e,n("div",he,[o(p,{onClick:l[0]||(l[0]=e=>ee()),size:"sm",class:"col-1 bton-lista-docente",color:"secondary",style:{color:"white"}},{default:s(()=>[c("NUEVO DOCENTE")]),_:1})])])]),_:1}),o(Q,null,{default:s(()=>[o(ce,{title:"Lista de Docentes",rows:S.value,columns:W,"row-key":"name","rows-per-page-options":[5,10,0]},{top:s(()=>[we]),header:s(e=>[o(F,{props:e},{default:s(()=>[(i(!0),m(f,null,I(e.cols,t=>(i(),E(B,{key:t.name,props:e},{default:s(()=>[c(A(t.label),1)]),_:2},1032,["props"]))),128)),o(B,{"auto-width":""},{default:s(()=>[c("Opciones")]),_:1})]),_:2},1032,["props"])]),body:s(e=>[o(F,{props:e,class:ue(e.row.estado?e.row.isActual?"bg-indigo-1":"":"bg-red-1 ")},{default:s(()=>[(i(!0),m(f,null,I(e.cols,t=>(i(),E(M,{key:t.name,props:e},{default:s(()=>[t.name=="estado"?(i(),m("div",ye,[o(p,{size:"sm",color:t.value?"positive":"negative",dense:"",label:t.value?"ACTIVO":"INACTIVO",onClick:V=>e.row.isActual?"":ae(e.row)},null,8,["color","label","onClick"]),e.row.isActual?de("",!0):(i(),E(G,{key:0,offset:[10,10],class:"bg-indigo"},{default:s(()=>[c(" Cambiar estado cuenta ")]),_:1}))])):t.name=="rol"?(i(),m(f,{key:1},[e.row.isActual?(i(),m(f,{key:1},[c(A(t.value),1)],64)):(i(),E(me,{key:0,modelValue:e.row.rol,"onUpdate:modelValue":[V=>e.row.rol=V,V=>se(e.row)],dense:"",options:J},null,8,["modelValue","onUpdate:modelValue"]))],64)):(i(),m(f,{key:2},[c(A(t.value),1)],64))]),_:2},1032,["props"]))),128)),o(M,{align:"center","auto-width":""},{default:s(()=>[n("div",Oe,[o(p,{size:"sm",color:"warning",round:"",dense:"",onClick:t=>le(e.row),icon:"mdi-account-edit"},null,8,["onClick"]),o(G,{offset:[10,10],class:"bg-indigo"},{default:s(()=>[c(" Editar docente ")]),_:1})])]),_:2},1024)]),_:2},1032,["props","class"])]),_:1},8,["rows"])]),_:1})]),_:1})]),Ce,o(P,{modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=e=>C.value=e)},{default:s(()=>[o(q,null,{default:s(()=>[o(Q,{class:"header-crear-docente card-title-gestionar"},{default:s(()=>[n("div",Ne,A(k.value),1)]),_:1}),o(Z,{class:"q-separator-crear-docente"}),o(Q,{style:{"max-height":"70vh"},class:"scroll body-crear-docente"},{default:s(()=>[o(fe,{onSubmit:te,onReset:T,class:"q-gutter-x-md"},{default:s(()=>[n("div",Ve,[o(v,{class:"col label-mid",filled:"",modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=e=>g.value=e),label:"Primer nombre","lazy-rules":"",rules:[e=>e&&e.length>0||"Completa este campo"]},null,8,["modelValue","rules"]),o(v,{class:"col label-mid",filled:"",modelValue:b.value,"onUpdate:modelValue":l[2]||(l[2]=e=>b.value=e),label:"Segundo nombre"},null,8,["modelValue"])]),n("div",Ae,[o(v,{class:"col label-mid",filled:"",modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=e=>_.value=e),label:"Primer apellido","lazy-rules":"",rules:[e=>e&&e.length>0||"Completa este campo"]},null,8,["modelValue","rules"]),o(v,{class:"col label-mid",filled:"",modelValue:h.value,"onUpdate:modelValue":l[4]||(l[4]=e=>h.value=e),label:"Segundo apellido","lazy-rules":"",rules:[e=>e&&e.length>0||"Completa este campo"]},null,8,["modelValue","rules"])]),o(v,{filled:"",modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=e=>w.value=e),class:"col label-mid",suffix:"@unl.edu.ec",label:"Correo institucional","lazy-rules":"",rules:[e=>e&&e.length>0||"Completa este campo",e=>/^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i.test(e+"@unl.edu.ec")||"Formato de email no v\xE1lido"]},null,8,["modelValue","rules"]),n("div",Qe,[n("div",ke,[o(v,{class:"col label-mid",filled:"",modelValue:y.value,"onUpdate:modelValue":l[6]||(l[6]=e=>y.value=e),label:"Numero de C\xE9dula","lazy-rules":"",rules:[e=>e&&e.length>0||"Completa este campo",e=>e.length==10&&!isNaN(e)||"C\xE9dula no correcta"]},null,8,["modelValue","rules"])]),n("div",Ke,[o(v,{class:"col label-mid",filled:"",modelValue:O.value,"onUpdate:modelValue":l[7]||(l[7]=e=>O.value=e),label:"Dedicaci\xF3n","lazy-rules":"",rules:[e=>e&&e.length>0||"Completa este campo"]},null,8,["modelValue","rules"])])]),o(Z,{class:"q-separator-crear-docente"}),o(j,{align:"right",class:"header-crear-docente"},{default:s(()=>[o(p,{type:"reset",class:"btn-cancelar-docente",flat:"",label:"Cancelar",color:"white"}),o(p,{type:"submit",class:"btn-crear-docente",flat:"",label:"Guardar",color:"white"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(P,{modelValue:D.value,"onUpdate:modelValue":l[10]||(l[10]=e=>D.value=e),persistent:""},{default:s(()=>[o(q,{style:{"max-width":"400px"}},{default:s(()=>[o(Q,{class:"row items-center"},{default:s(()=>[n("div",De,[n("div",Ee,[o(re,{icon:"warning",color:"warning","text-color":"white"})]),n("div",xe,[n("span",null,[c("Est\xE1 a p\xFAnto de cambiar el estado de cuenta del docente: "),n("b",null,A(x.value.nombre),1)])])])]),_:1}),o(j,{align:"right"},{default:s(()=>[ie(o(p,{flat:"",label:"Cancel",color:"negative"},null,512),[[pe]]),o(p,{flat:"",label:"Aceptar",color:"primary",onClick:l[9]||(l[9]=e=>oe())})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Be as default};
