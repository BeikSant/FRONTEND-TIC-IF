import{m as w}from"./QDialog.b0ec289d.js";import{a as y,Q as N}from"./QTable.21f90b65.js";import{Q as k,a as F}from"./QTd.e5502f91.js";import{r as O,E as c,O as p,J as s,G as i,H as S,F as b,R as I,P,N as g,Q as C,K as d,L as Q}from"./index.7d30eca8.js";import{c as q,b as T}from"./QCard.54856d72.js";import{i as B,g as K,e as L}from"./especifica-controller.9e7406e6.js";import"./downloadPdf.2aeda141.js";const R={class:"q-ma-md"},j=d("div",{class:"row justify-between"},[d("div",{class:"col-9"},[d("div",{class:"col q-table__title",inline:""},[d("b",null,"Historial de informes")])])],-1),H=d("div",{class:"col q-table__title"},[d("b",null,"Lista de Informes")],-1),X={__name:"MainPage",setup(M){const h=S(),_=T(),D=[{name:"periodo",label:"Periodo",sortable:!0,field:"periodo",align:"left"},{name:"informe",label:"Informe",sortable:!0,field:"informe",align:"center",style:"max-width: 400px; white-space: break-spaces;"},{name:"fechaInicio",label:"Fecha Inicial",sortable:!1,field:"fechaInicio",align:"center"},{name:"fechaFin",label:"Fecha Final",sortable:!1,field:"fechaFin",align:"center"}],f=O([]),x=async()=>{await B.obtenerTodosInformes(o=>{if(o.status!=200)return v();const e=o.data.informes;f.value=[];for(let a=0;a<e.length;a++)e[a].periodoAcademico.estado||f.value.push({periodo:e[a].periodoAcademico.nombre,fechaInicio:new Date(e[a].periodoAcademico.fechaInicio).toLocaleDateString(),fechaFin:new Date(e[a].periodoAcademico.fechaFin).toLocaleDateString(),informe:e[a].formato.nombreFormato,id:e[a]._id,idformato:e[a].formato._id})})};async function A(o){const e=await E(o.id);K.generarPDF(o.id,e,o.periodo,o.idformato)}const E=async o=>{let e=[];await L.obtenerActividadesPorInforme(o,t=>{if(t.status!=200)return v();const n=t.data.actividadesEspecificas;for(let r=0;r<n.length;r++){let l=!1;for(let m=0;m<e.length;m++)e[m].nombre==n[r].actividadDistributivo.funcionSustantiva.nombre&&(l=!0);(r==0||!l)&&e.push({nombre:n[r].actividadDistributivo.funcionSustantiva.nombre,actividadesEspecificas:[]})}for(let r=0;r<n.length;r++)for(let l=0;l<e.length;l++)n[r].actividadDistributivo.funcionSustantiva.nombre==e[l].nombre&&e[l].actividadesEspecificas.push(n[r])});function a(t,n){return t.nombre<n.nombre?-1:t.nombre>n.nombre?1:0}return e.sort(a)};x();const v=o=>{if(o.status==401)return u("NO OK",o.message),h.re("/login");if(o.status==403)return u("NO OK",o.message),h.push({path:"/"});if(o.status!=200)return u("NO OK",o.message)},u=(o,e)=>{o=="OK"?_.notify({color:"green-5",textColor:"white",icon:"mdi-check-bold",message:e}):_.notify({color:"red-5",textColor:"white",icon:"warning",message:e})};return(o,e)=>(c(),p("div",R,[s(q,{class:"my-card"},{default:i(()=>[s(w,{class:"card-title-gestionar"},{default:i(()=>[j]),_:1}),s(w,{class:"bg-blue-1"},{default:i(()=>[(c(),b(N,{columns:D,rows:f.value,"row-key":"name","no-data-label":"No posee un historial de informes",key:"tablePeriodo",pagination:{rowsPerPage:10},"rows-per-page-label":"Resultados por p\xE1gina"},{top:i(()=>[H]),header:i(a=>[s(k,{props:a},{default:i(()=>[(c(!0),p(I,null,P(a.cols,t=>(c(),b(y,{key:t.name,props:a},{default:i(()=>[g(Q(t.label),1)]),_:2},1032,["props"]))),128)),s(y,{"auto-width":""},{default:i(()=>[g("Acciones")]),_:1})]),_:2},1032,["props"])]),body:i(a=>[s(k,{props:a},{default:i(()=>[(c(!0),p(I,null,P(a.cols,t=>(c(),b(F,{key:t.name,props:a},{default:i(()=>[g(Q(t.value),1)]),_:2},1032,["props"]))),128)),s(F,{align:"center","auto-width":"",class:"q-pa-md q-gutter-xs"},{default:i(()=>[s(C,{size:"sm",color:"orange",round:"",dense:"",onClick:t=>o.confirmacionEliminarPeriodo(a.row),icon:"mdi-eye-outline"},null,8,["onClick"]),s(C,{size:"sm",color:"positive",round:"",dense:"",icon:"mdi-download",onClick:t=>A(a.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows"]))]),_:1})]),_:1})]))}};export{X as default};
